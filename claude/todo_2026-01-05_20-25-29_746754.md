# Todo List: Phase 1.2 - Relationship & Hierarchy Access

**Generated**: 2026-01-05 20:25:29 America/Toronto
**Task Summary**: Implement work package relationship and hierarchy traversal for dependency analysis

## Context

This implements Phase 1.2 from ROADMAP.md, which is CRITICAL for agentic capabilities.

**Goal**: Enable Claude to understand work package dependencies, parent-child hierarchies, and relationships (blocks, relates to, etc.).

**Why This Matters**: Without relationship data, Claude cannot identify blockers, critical paths, or understand project structure. This is essential for risk analysis and dependency management.

**Dependencies**: Phase 1.1 (Bulk Data Loading) - COMPLETED âœ…

## Tasks

### 1. Type Definitions for Relations

- [ ] Add `RelationType` enum
  - File(s): `src/types.ts`
  - Complexity: simple
  - Dependencies: none
  - Details: Define relation types (blocks, blocked_by, parent, child, relates, duplicates, etc.)

- [ ] Add `Relation` interface
  - File(s): `src/types.ts`
  - Complexity: simple
  - Dependencies: Task 1a
  - Details: Relation structure with from/to work packages, type, description

- [ ] Add `WorkPackageHierarchy` interface
  - File(s): `src/types.ts`
  - Complexity: moderate
  - Dependencies: Task 1a, 1b
  - Details: Tree structure for parent-child relationships

### 2. API Client Methods for Relations

- [ ] Add `getWorkPackageRelations` method
  - File(s): `src/openproject-client.ts`
  - Complexity: moderate
  - Dependencies: Task 1
  - Details: Fetch all relations for a work package
  - Endpoint: `/api/v3/work_packages/{id}/relations`

- [ ] Add `getWorkPackageChildren` helper method
  - File(s): `src/openproject-client.ts`
  - Complexity: simple
  - Dependencies: Task 2a
  - Details: Get direct children of a work package

- [ ] Add `getWorkPackageParent` helper method
  - File(s): `src/openproject-client.ts`
  - Complexity: simple
  - Dependencies: Task 2a
  - Details: Get parent of a work package

### 3. Hierarchy Traversal

- [ ] Add `getWorkPackageHierarchy` method
  - File(s): `src/openproject-client.ts`
  - Complexity: complex
  - Dependencies: Tasks 1, 2
  - Details: Recursively load parent and all children to build tree structure
  - Include depth limiting to prevent infinite recursion

- [ ] Add `getAllBlockingRelations` helper
  - File(s): `src/openproject-client.ts`
  - Complexity: moderate
  - Dependencies: Task 2a
  - Details: Get all work packages that are blocking a given work package

- [ ] Add `getAllBlockedRelations` helper
  - File(s): `src/openproject-client.ts`
  - Complexity: moderate
  - Dependencies: Task 2a
  - Details: Get all work packages that are blocked by a given work package

### 4. MCP Tools for Relationships

- [ ] Add `get_work_package_relations` tool
  - File(s): `src/index.ts`
  - Complexity: simple
  - Dependencies: Task 2a
  - Details: Expose relations to Claude

- [ ] Add `get_work_package_hierarchy` tool
  - File(s): `src/index.ts`
  - Complexity: simple
  - Dependencies: Task 3a
  - Details: Expose hierarchy tree to Claude

- [ ] Add `find_blocking_work_packages` tool
  - File(s): `src/index.ts`
  - Complexity: simple
  - Dependencies: Task 3b
  - Details: Quick tool to find what's blocking a work package

### 5. Enhanced Project Overview with Relations

- [ ] Update `ProjectOverview` interface to include relationship summary
  - File(s): `src/types.ts`
  - Complexity: simple
  - Dependencies: Task 1
  - Details: Add blocked count, blocking count, orphaned count

- [ ] Update `calculateProjectStatistics` to include relationship metrics
  - File(s): `src/openproject-client.ts`
  - Complexity: moderate
  - Dependencies: Tasks 2, 5a
  - Details: Compute relationship statistics for project overview

- [ ] Add `getProjectWithRelations` method (optional enhancement)
  - File(s): `src/openproject-client.ts`
  - Complexity: complex
  - Dependencies: Tasks 2, 3
  - Details: Load project with all work packages AND their relations

### 6. Documentation Updates

- [ ] Update README.md with relationship tools
  - File(s): `README.md`
  - Complexity: simple
  - Dependencies: All previous tasks
  - Details: Document new relationship and hierarchy tools

- [ ] Add dependency analysis examples
  - File(s): `README.md`
  - Complexity: simple
  - Dependencies: Task 6a
  - Details: Show how Claude can now identify blockers and dependencies

### 7. Build and Verification

- [ ] Verify TypeScript compilation
  - File(s): N/A
  - Complexity: simple
  - Dependencies: All code tasks
  - Details: Run npm run build

- [ ] Verify tool definitions are correct
  - File(s): N/A
  - Complexity: simple
  - Dependencies: Task 4
  - Details: Check tool schemas and descriptions

## Verification

- [ ] Build succeeds without TypeScript errors
- [ ] All new tools appear in MCP tool list
- [ ] Relationship data structures are correctly typed
- [ ] Hierarchy traversal doesn't cause infinite loops
- [ ] Documentation is complete and accurate

## Notes

**API Endpoints**:
- `/api/v3/work_packages/{id}/relations` - Get all relations for a work package
- Relations include: blocks, blocked_by, parent, children, relates, duplicates, etc.
- Need to handle circular dependencies gracefully

**Relationship Types in OpenProject**:
- `blocks` - This work package blocks another
- `blocked_by` - This work package is blocked by another
- `precedes` - This work package must be done before another
- `follows` - This work package must be done after another
- `relates` - General relationship
- `duplicates` - This duplicates another work package
- `duplicated_by` - This is duplicated by another

**Hierarchy Considerations**:
- Parent-child relationships are separate from blocking relationships
- Need max depth parameter to prevent excessive recursion
- Consider performance for large hierarchies (100+ children)

**Success Criteria**:
When complete, Claude should be able to:
- Identify what's blocking a work package
- See the full hierarchy of a work package (parent, children, grandchildren)
- Understand dependencies between work packages
- Find orphaned work packages (no parent, no relations)
- Perform critical path analysis (foundation for Phase 4.3)
